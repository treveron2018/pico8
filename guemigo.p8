pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--guemigo
--by rastro de luna and treveron

--todo
--get platforming code from 20uls

--bugs
--ffix wobble

function _init()
	poke(0x5f2d,1)
	cur={
		x=stat(32),
		y=stat(33),
		w=8,
		h=8,
		bt=stat(34)	
	}
	gue={
		sx=16,
		sy=0,
		sw=8,
		sh=8
	}
	main_gue()	
	create_buttons()
	_upd=upd_main
	_drw=drw_main
end

function _update()
	_upd()
	upd_cur()
end

function _draw()
	cls(1)
	_drw()
	drw_cur()

--debug	
	--print(debug,0,0,7)
end

function upd_main()
	upd_buttons()
	upd_gue()
end

function drw_main()
	drw_buttons()
	drw_gue()
end

-->8
--cursor

function upd_cur()
	cur.x=stat(32)
	cur.y=stat(33)
	cur.bt=stat(34)
	click()
end

function drw_cur()
	spr(1,cur.x,cur.y)
end

function click()
	local click=get_butt()
	if cur.bt==0 then
		if not cur.rel and click then
			if click==2 then
				_upd=upd_game
				_drw=drw_game
				game_gue()
			end
			
		elseif not cur.rel and box_col(cur,gue) then
			--guemigo press effect
			debug="guemigo"		
		end
		cur.rel=true
	else
		cur.rel=false
	end
end
-->8
--ui

function create_buttons()
	buttons={}
	local _sp,_id=16,1
	for _y=8,104,96 do
		for _x=8,104,32 do
			local b={
				x=_x,
				y=_y,
				w=16,
				h=16,
				id=_id,
				sp=_sp,
				sel=false
			}
			add(buttons,b)
			_id+=1
			_sp+=2		
		end
	end
end

function upd_buttons()
	for b in all(buttons) do
		if box_col(cur,b) and cur.bt==1 then
			b.sel=true
		else
			b.sel=false
		end
	end
end

function drw_buttons()
	for b in all(buttons) do
		local offx,offy=1,1
		if not(b.sel) then
			shadow(b,2,2)
			offx,offy=0,0
		end
		spr(b.sp,b.x+offx,b.y+offy,2,2)
		--if(b.sel)rect(b.x-2, b.y-2, b.x+b.w+1,b.y+b.h+1,7)
	end
end

function get_butt()
	for b in all(buttons) do
		if(b.sel)return b.id
	end
	return false
end
-->8
--tools

function box_col(b1,b2)
	--checks if b1 is the cursor
	local b1w= b1!=cur and b1.w or 0
	local b1h= b1!=cur and b1.h or 0
	if b1.x>b2.x+b2.w
	or b1.x+b1w<b2.x
	or b1.y+b1h<b2.y
	or b1.y>b2.y+b2.h
	then return false
	else return true
	end
end

function shadow(obj,w,h)
	for i=1,16 do
		pal(i,13)
	end
	spr(obj.sp,obj.x+1,obj.y+1,w,h)
	pal()
end

function wobble(o)
	local wob=sin(o.t/30)
	o.x,o.y=o.x-wob/2,o.y+wob
	o.w,o.h=o.w+wob,o.h+wob*-1
	return o
end
-->8
--gue

function upd_gue()
	gue.t+=1
	gue=wobble(gue)
end

function drw_gue()
	sspr(gue.sx,gue.sy,gue.sw,gue.sh,gue.x,gue.y,gue.w,gue.h)
end
-->8
--minigame

function game_gue()
	gue.dx,gue.dy,gue.x,gue.y,gue.w,gue.h,gue.t=0,0,0,56,8,8,0
end

function upd_game_gue()
	--get platforming code from 20uls
end

function upd_game()
	upd_game_gue()
	if btnp(🅾️) then
		_upd=upd_main
		_drw=drw_main
		main_gue()
	end
end

function drw_game()
	map(0)
	drw_gue()
end
-->8
--main

function main_gue()
	gue.x,gue.y,gue.w,gue.h,gue.t=40,40,56,56,0
end
__gfx__
000000007777700000000000000000000000000000000000000cc000bb3b3b3b0000000000000000000000000000000000000000000000000000000000000000
00000000777770000007a0000007a0000007a0000007a000000cc00043b33bb40000000000000000000000000000000000000000000000000000000000000000
0070070077770000007a2200007a2200007a2200007a02000cccccc044434b490000000000000000000000000000000000000000000000000000000000000000
00077000777770000aaa22a00aaa22a00aaa22a00aaa20a0cceccecc944943450000000000000000000000000000000000000000000000000000000000000000
00077000770777000aaaaaa00aaa0aa00a0a0aa00a0a0aa0cccccccc594544490000000000000000000000000000000000000000000000000000000000000000
00700700000077700a22aaa00a20aaa00a20aaa00a20a0a0ccceeccc454449450000000000000000000000000000000000000000000000000000000000000000
00000000000007770a22aa400a22aa400a020a400a020a400cccccc0494945440000000000000000000000000000000000000000000000000000000000000000
000000000000007700aa440000aa440000aa440000aa440000cccc00454544440000000000000000000000000000000000000000000000000000000000000000
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
aaaaaaaaaaaaaaaa2222222222222222333333333333333344444444444444445555555555555555666666666666666677777777777777778888888888888888
__gff__
0000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
